# Taro 3 升级指南

- jsx 不支持 hidden 属性；
- this.$router.params 使用 Taro.getCurrentInstance().router.params 替代；
- let app = Taro.getApp() 使用 let app = Taro.Current 替代；

## 常见错误

- 使用 Taro 3.0 版本写微信小程序写类组件控制台输出：
  
`MiniProgramError Super expression must either be null or a function`

需要更新写法：

React.Component 代替 Taro.Component

- [问题描述：const taro = Taro；执行taro.getNetworkType({})报错]

Taro 版本统一，保持所有库都是一个版本；不一致时，删除所有包和 lock 文件，重新安装。

## 分包优化

修改 webpack 配置，利用 splitChunks 特性，将子包公共文件单独提取，避免主包过大；

```js
webpackChain (chain, webpack) {
      chain.plugin('analyzer')
        .use(require('webpack-bundle-analyzer').BundleAnalyzerPlugin, [])
        const config = chain.optimization.get('splitChunks')
        chain.optimization
          .splitChunks({
            ...config,
            cacheGroups: {
              ...config.cacheGroups,
              subutils: {
                name: 'packageB/sub-common',
                minChunks: 2,
                test: module => /[\\/]packageB[\\/]/.test(module.resource),
                priority: 200
              }
            }
          })
    },
    addChunkPages (pages) {
      pages.set('packageB/sub1', ['packageB/sub-common'])
      pages.set('packageB/sub2', ['packageB/sub-common'])
    }
```

## 子包公共文件提取

```js
const { stats, config } = await compile('subpackages', {
      webpackChain (chain) {
        const config = chain.optimization.get('splitChunks')
        chain.optimization
          .splitChunks({
            ...config,
            cacheGroups: {
              ...config.cacheGroups,
              subutils: {
                name: 'sub-utils',
                minChunks: 2,
                test: module => /[\\/]packageA[\\/]/.test(module.resource),
                priority: 200
              }
            }
          })
      },
      addChunkPages (pages) {
        pages.set('packageA/detail/index', ['sub-utils'])
        pages.set('packageA/my/index', ['sub-utils'])
      }
    })
```

## 自定义的装饰器

自定义装饰器和 Redux 装饰器冲突问题，如果出现如下报错信息：
taro 3 TypeError: Super expression must either be null or a function

```js
// 错误的写法
@custom
@connect

// 正确的装饰器顺序
@connect
@custom
```